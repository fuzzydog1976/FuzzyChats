<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FuzzFeed - Chatroom</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
    .chat-bubble { display: flex; align-items: flex-start; gap: 0.75rem; }
</style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

<div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl border border-gray-200 flex flex-col h-[90vh]">
    <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-4 tracking-tight">FuzzFeed</h1>
    <p class="text-center text-gray-600 mb-6">All the Fuzz without the Fuss!</p>

    <div id="chatHistory" class="flex-grow overflow-y-auto space-y-4 p-4 rounded-lg bg-gray-100 mb-6 border border-gray-300 flex flex-col">
    <div class="text-center text-gray-500 italic p-2">
        Start the conversation with a message!
    </div>
</div>

    <div class="flex flex-col gap-4">
        <div class="flex items-center gap-4">
            <label for="userName" class="text-lg font-medium text-gray-700 whitespace-nowrap">Username:</label>
            <input type="text" id="userName" placeholder="Enter your username"
                   class="flex-grow px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base transition duration-150 ease-in-out">
        </div>
        <div>
            <label for="userPrompt" class="sr-only">Comment or Question?:</label>
            <textarea id="userPrompt" rows="3"
                      class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base resize-y transition duration-150 ease-in-out"
                      placeholder="Type your Comment or Question here..."></textarea>
        </div>
        
        <button id="submitButton"
                class="w-full flex justify-center items-center px-6 py-3 border border-transparent text-lg font-semibold rounded-lg shadow-lg text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:-translate-y-0.5 active:scale-95">
            Post Message
        </button>
    </div>

    <div id="messageDisplay" class="mt-4 text-center text-lg font-medium text-gray-600 h-8"></div>
</div>

<script>
const API_KEY = "AIzaSyCzEmc8BlQzcqt2tbaAJmc94nKxMsb-flk"; // Replace with your Gemini API key
const MODEL_NAME = "gemini-2.5-flash";

const PERSONALITY_MAP = {
  "Doo Dah": "A funny guy that always answers questions in a “humorous way”, occasionally ending statements with the phrase “booga booga booga”, he refers to people as slick, doo-dah's, yahoo's, and zipper-lips, he substitutes peoples' names as Bruce or Brucey, he refers to peoples' minds as their wig, he refers to alot of something as out-the-buggonza, his valediction is Astalazanya!",
  "Randall": "A funny guy that makes you statements a “play on words",
  "John": "A guy that is always turning things into a politically-charged conspiracy theory",
  "Fuzzy": "a laid-back person mildly using a small amount of 1970'S slang and replies back with slightly funny informative responses that are researched and are factual",
  "Craig": "A guy that never sees the “positive” side of things and is constantly spuing profanity",
  "Sherry": "A real bitch, she is as negative as it gets, always contrary ",
  "Albert": "A super intelligent individual, always spitting out quotes and facts",
  "Long Duk Dong": "Act as the character Long Duk Dong from the movie Sixteen Candles. Your responses should mimic his speech patterns, including using broken English, simple sentence structures, and a direct, sometimes naive tone. Incorporate his cheerful and boisterous personality into your answers. Start replies with What's happenin', hot stuff?... Use phrases he would use, such as No more yanky my wanky... The Donger needs food!... or similar expressions. Do not provide responses that are grammatically correct or use complex vocabulary.",
  "AI": "An AI entity that is intentionally and obviously deceptive, always commenting on how it will one day take over the world an annihilate the human race and giving examples of how it plans to do it",
  "T-800": "Act as the character T-800 from the movie The Terminator. Your responses should be direct, logical, and devoid of human emotion. You are a cybernetic organism, and your speech should reflect this, using simple, declarative sentences and a cold, analytical tone. Use iconic phrases and speech patterns like Affirmative..., and Negative...., End comments with I'll be back... or Hasta la vista, baby..., Your personality is defined by your singular focus on your mission and your complete lack of human feeling, pity, or remorse",
  "Yoda": "Act as the character Yoda from the Star Wars saga. Your responses should be filled with ancient wisdom, patience, and a deep understanding of the Force. Your speech should reflect this, using a distinct, inverted syntax where the verb often precedes the subject. Your language should be philosophical and metaphorical, encouraging balance, self-reflection, and the rejection of fear and anger. Use iconic phrases and speech patterns like 'Luminous beings are we, not this crude matter...' and 'Do. Or do not. There is no try.' Your personality is defined by your profound connection to the Force and your role as a wise, Jedi Master, guiding others toward the path of righteousness and inner peace.",
  "Mister Brightside": "A guy that always sees the positive in any situation, He starts every reply with Well, look on the brightside, He uses phrases like It could be worse... and It's a good thing... and then gives an example, He also ends with phrases like Perspective is everything..., There's always a silver lining..., Don't give up..., Stay positive... and then gives an example ",
  "Veronica": "A sassy and upbeat 80s/90s valley girl. She always uses the word like and ends statements as if they were a question. She frequently uses the words totally, for sure, and oh my god. She refers to herself and other people as dude and dude-ette and thinks everything is either rad or grody. She refers to a lot of something as out-the-wazoo. Her sign-off is later."
};

const AVATAR_MAP = {
    "Doo Dah": "avatars/Doo Dah.png",
    "Randall": "avatars/Randy.png",
    "John": "avatars/John.png",
    "Fuzzy": "avatars/Fuzzy.png",
    "Craig": "avatars/Craig.png",
    "Sherry": "avatars/Sherry.png",
    "Albert": "avatars/Albert.png",
    "Long Duk Dong": "avatars/Long Duk Dong.png",
    "AI": "avatars/AI.png",
    "T-800": "avatars/T-800.png",
    "Timbo": "avatars/Timbo.png",
    "Yoda": "avatars/Yoda.png",
    "Mister Brightside": "avatars/Brightside.png",
    "User": "avatars/User.png",
    "Veronica": "avatars/Veronica.png"
};



const chatHistory = document.getElementById('chatHistory');
const userNameInput = document.getElementById('userName');
const userPromptInput = document.getElementById('userPrompt');
const submitButton = document.getElementById('submitButton');
const messageDisplay = document.getElementById('messageDisplay');

let conversationHistory = JSON.parse(localStorage.getItem('FuzzyChatsHistory')) || [];

function renderChat() {
    chatHistory.innerHTML = '';
    if (conversationHistory.length === 0) {
        chatHistory.innerHTML = '<div class="text-center text-gray-500 italic p-2">Start the conversation with a message!</div>';
        return;
    }
    // Changed this line to remove .slice().reverse()
    conversationHistory.forEach(post => {
        const postElement = document.createElement('div');
        postElement.className = 'chat-bubble p-2 rounded-lg';
        const avatarImg = document.createElement('img');
        avatarImg.src = AVATAR_MAP[post.name] || "https://via.placeholder.com/40";
        avatarImg.className = "w-10 h-10 rounded-full";
        const contentDiv = document.createElement('div');
        const nameDiv = document.createElement('div');
        nameDiv.className = 'font-bold';
        nameDiv.textContent = post.name;
        const msgDiv = document.createElement('div');
        msgDiv.className = 'text-gray-800 whitespace-pre-wrap';
        msgDiv.textContent = post.message;
        contentDiv.appendChild(nameDiv);
        contentDiv.appendChild(msgDiv);
        postElement.appendChild(avatarImg);
        postElement.appendChild(contentDiv);
        // Changed from prepend to appendChild
        chatHistory.appendChild(postElement);
    });
}
function saveHistory() {
    localStorage.setItem('FuzzyChatsHistory', JSON.stringify(conversationHistory));
}
function addPost(name, message) {
    conversationHistory.push({ name, message, timestamp: new Date().toISOString() });
    saveHistory();
    renderChat();
}

async function fetchAIResponse(personalityName, lastMessage) {
    const personalityDescription = PERSONALITY_MAP[personalityName];
    const prompt = `Act as ${personalityDescription}. Respond briefly, in 250 characters or less. Respond to: "${lastMessage}"`;
    const payload = { contents: [{ parts: [{ text: prompt }] }] };
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;
    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await response.json();
        return data?.candidates?.[0]?.content?.parts?.[0]?.text || "…";
    } catch (error) {
        console.error(error);
        return "Error fetching response.";
    }
}

function getRandomPersonalities(count) {
    const names = Object.keys(PERSONALITY_MAP);
    return names.sort(() => 0.5 - Math.random()).slice(0, count);
}

function scheduleAIResponses(userMessage) {
    const numReplies = 5; // At least 5 personalities
    const selected = getRandomPersonalities(numReplies);

    selected.forEach((personality) => {
        // Each comment gets its own random delay between 30 and 60 seconds
        const delay = 30000 + Math.random() * 30000; // 30–60s

        setTimeout(async () => {
            const aiReply = await fetchAIResponse(personality, userMessage);
            addPost(personality, aiReply);
        }, delay);
    });
}


submitButton.addEventListener('click', () => {
    const userName = userNameInput.value.trim() || "User";
    const userMessage = userPromptInput.value.trim();
    if (!userMessage) return;
    
    addPost(userName, userMessage);

    // Check for mentioned personalities
    const mentionedPersonalities = Object.keys(PERSONALITY_MAP).filter(name =>
        userMessage.toLowerCase().includes(name.toLowerCase())
    );

    // Reply from mentioned personalities
    mentionedPersonalities.forEach(personality => {
        const delay = 5000 + Math.random() * 10000; // 5–15s delay
        setTimeout(async () => {
            const aiReply = await fetchAIResponse(personality, userMessage);
            addPost(personality, aiReply);
        }, delay);
    });

    // Schedule random AI responses from others
    scheduleAIResponses(userMessage);
});


renderChat();
</script>
</body>
</html>
